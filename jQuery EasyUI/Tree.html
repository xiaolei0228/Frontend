<!DOCTYPE html>
<html>
<head>
    <title>Tree</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href="resource/themes/default/easyui-all.css" rel="stylesheet">
    <link href="resource/themes/icon.css" rel="stylesheet">
    <script src="resource/jquery.min.js" type="text/javascript"></script>
    <script src="resource/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="resource/locale/easyui-lang-zh_CN.js" type="text/javascript"></script>
</head>
<body>
<div id="tree"></div>
</body>
</html>
<script type="text/javascript">
    $(document).ready(initTree);

    function initTree() {
        var treeDate = [
            {"id": "2", "fid": "1", "text": "系统设置", "nodeUrl": "Admin"},
            {"id": "5", "fid": "1", "text": "笔记本", "nodeUrl": "Admin"},
            {"id": "3", "fid": "2", "text": "系统角色管理", "nodeUrl": "Admin&m=Sys&a=manageRole"},
            {"id": "4", "fid": "2", "text": "系统菜单管理", "nodeUrl": "Admin&m=Sys&a=manageNode"},
            {"id": "8", "fid": "2", "text": "用户管理", "nodeUrl": "Admin&m=Sys&a=manageUser"},
            {"id": "6", "fid": "5", "text": "笔记列表", "nodeUrl": "Admin&m=LjbNote"},
            {"id": "7", "fid": "5", "text": "添加笔记", "nodeUrl": "Admin&m=LjbNote&a=saveNote"},
            {"id": "9", "fid": "5", "text": "管理分类", "nodeUrl": "Admin&m=LjbNote&a=manageType"},
            {"id": "10", "fid": "5", "text": "test", "nodeUrl": ""}
        ];
        treeDate = makeEasyTree(treeDate);
        alert(JSON.stringify(treeDate));
        $('#tree').tree({
            data: treeDate
        });
    }

    /**
     * 生成eadyui能解析的有层次关系的树的json对象
     * @param data
     * @returns {Array}
     */
    function makeEasyTree(data) {
        if (!data)
            return [];
        var _newData = []; //最终返回结果
        var _treeArray = {}; //记录一级节点
        var _root = 1; //最顶层fid
        var _idKey = "id"; //主键的键名
        var _fidKey = "fid"; //父ID的键名
        _getChildren(_root);
        function _getChildren($root) {
            var $children = [];
            for (var i in data) {
                if ($root == data[i][_fidKey]) {
                    data[i]["children"] = _getChildren(data[i][_idKey]);
                    $children.push(data[i]);
                }
                //只要一级节点
                if (_root == data[i][_fidKey] && !_treeArray[data[i][_idKey]]) {
                    _treeArray[data[i][_idKey]] = data[i];
                    _newData.push(data[i]);
                }
            }
            return $children;
        }

        return _newData;
    }

    /**
     * 生成eadyui能解析的有层次关系的树的json对象
     * @param rows
     * @returns {Array}
     */
    function makeEasyTree2(rows) {
        function exists(rows, pid) {
            for (var i = 0; i < rows.length; i++) {
                if (rows[i].id == pid) return true;
            }
            return false;
        }

        var nodes = [];
        // 得到顶层节点
        for (var i = 0; i < rows.length; i++) {
            var row = rows[i];
            if (!exists(rows, row.pid)) {
                nodes.push({
                    id: row.id,
                    text: row.text,
                    pid: row.pid,
                    iconCls: row.iconCls
                });
            }
        }

        var toDo = [];
        for (var i = 0; i < nodes.length; i++) {
            toDo.push(nodes[i]);
        }
        while (toDo.length) {
            var node = toDo.shift();    // 父节点
            // 得到子节点
            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                if (row.pid == node.id) {
                    var child = {id: row.id, text: row.text, pointId: row.pointId, djip: row.djip};
                    if (node.children) {
                        node.children.push(child);
                    } else {
                        node.children = [child];
                    }
                    toDo.push(child);
                }
            }
        }
        return nodes;
    }
</script>